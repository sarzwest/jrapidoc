<!DOCTYPE html>
<html>
<head>
    <title>Rate Service</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <style>
        #detailSection input {
            width: 100%;
            border: none;
            font-size: 130%;
            color: black;
        }
    </style>
    <script src="js/properties.js"></script>
    <script src="js/Logger.js"></script>
    <script src="js/fblogin.js"></script>
    <script src="js/rate-js.js"></script>
    <script>
        var setSearchBar = function() {
            var ico = document.querySelector("#ico");
            ico["value"] = "Vložte IČO";
            ico.style = "color:gray";
        };

        var setSearchBarClick = function() {
            var ico = document.querySelector("#ico");
            ico.addEventListener("click", function() {
                if (ico["value"] === "Vložte IČO") {
                    ico.style = "color:black";
                    ico["value"] = "";
                }
            });
        };

        var setSubmitButtonClick = function() {
            var search = document.querySelector("#search");
            search.addEventListener("click", function(e) {
                e.preventDefault();
                getCompany(document.querySelector("#ico")["value"]);
                document.querySelector("#detailSection").style = "display:block";
            });
        };

        var setDetailButtonClick = function() {
            var detail = document.querySelector("#detail");
            detail.addEventListener("click", function(e) {
                e.preventDefault();
                document.querySelector("#detailSection").style = "display:block";
                document.querySelector("#ratingSection").style = "display:none";
                document.querySelector("#rateSection").style = "display:none";
            });
        };

        var setRatingButtonClick = function() {
            var detail = document.querySelector("#rating");
            detail.addEventListener("click", function(e) {
                e.preventDefault();
                document.querySelector("#detailSection").style = "display:none";
                document.querySelector("#ratingSection").style = "display:block";
                document.querySelector("#rateSection").style = "display:none";
                getRatings(companyToRate.ico);
                setRatingSectionData();
            });
        };

        var setRateButtonClick = function() {
            var detail = document.querySelector("#rate");
            detail.addEventListener("click", function(e) {
                e.preventDefault();
                document.querySelector("#detailSection").style = "display:none";
                document.querySelector("#ratingSection").style = "display:none";
                document.querySelector("#rateSection").style = "display:block";
                setRateSectionData();
            });
        };

        var setDetailSectionData = function() {
            var personName = document.querySelector("#personName");
            personName["value"] = companyToRate.person;
            var businessName = document.querySelector("#businessName");
            businessName["value"] = companyToRate.businessName;
            var icoNumber = document.querySelector("#icoNumber");
            icoNumber["value"] = companyToRate.ico;
            var residences = document.querySelector("#residences");
            for (i = 0; i < companyToRate.residences.length; i++) {
                var residence = document.createElement("input");
                residence["value"] = companyToRate.residences[i];
                residences.appendChild(residence);
            }
            var licenses = document.querySelector("#licenses");
            for (i = 0; i < companyToRate.licenses.length; i++) {

                var br = document.createElement("br");
                licenses.appendChild(br);
                var label = document.createElement("label");
                label.textContent = "Živnostenské oprávnění č." + (i + 1);
                licenses.appendChild(label);
                var br = document.createElement("br");
                licenses.appendChild(br);
                var scopeLabel = document.createElement("label");
                scopeLabel.textContent = "Předmet podnikání: ";
                licenses.appendChild(scopeLabel);
                var license = document.createElement("input");
                license["value"] = companyToRate.licenses[i].businessScope;
                licenses.appendChild(license);
                var br = document.createElement("br");
                licenses.appendChild(br);
                var typeOfTradeLabel = document.createElement("label");
                typeOfTradeLabel.textContent = "Druh živnosti: ";
                licenses.appendChild(typeOfTradeLabel);
                var typeOfTrade = document.createElement("input");
                typeOfTrade["value"] = companyToRate.licenses[i].typeOfTrade;
                licenses.appendChild(typeOfTrade);
                var br = document.createElement("br");
                licenses.appendChild(br);
                var activities = companyToRate.licenses[i].subjectActivity;
                if (activities !== null) {
                    var activityLabel = document.createElement("label");
                    activityLabel.textContent = "Obory činnosti: ";
                    licenses.appendChild(activityLabel);
                    var br = document.createElement("br");
                    licenses.appendChild(br);
                    for (j = 0; j < activities.length; j++) {
                        var activity = document.createElement("input");
                        activity["value"] = activities[j];
                        licenses.appendChild(activity);
                        var br = document.createElement("br");
                        licenses.appendChild(br);
                    }
                }
            }
        };

        var setRatingSectionData = function() {
            var ratingForm = document.querySelector("#ratingSection form");
            while (ratingForm.firstChild) {
                ratingForm.removeChild(ratingForm.firstChild);
            }
            for (var i = 0; i < companyAllRatings.length; i++) {
                var ratingLabel = document.createElement("label");
                ratingLabel.textContent = "Hodnocení č." + (i + 1);
                ratingForm.appendChild(ratingLabel);
                var br = document.createElement("br");
                ratingForm.appendChild(br);
                var ratingItem = companyAllRatings[i];
                var rating = document.createElement("p");
                rating.textContent = ratingItem.rating;
                ratingForm.appendChild(rating);
                var stars = document.createElement("span");
                stars.textContent = "Počet hvězd: " + ratingItem.stars;
                ratingForm.appendChild(stars);
                var br = document.createElement("br");
                ratingForm.appendChild(br);
                var ratedBy = document.createElement("span");
                ratedBy.textContent = "Od: " + ratingItem.ratedBy.name + " (" + ratingItem.ratedBy.email + ")";
                ratingForm.appendChild(ratedBy);
                var br = document.createElement("br");
                ratingForm.appendChild(br);
                var br = document.createElement("br");
                ratingForm.appendChild(br);
            }
        };

        var setRateSectionData = function() {
            document.querySelector("#companyWithIco").textContent = "IČO firmy: " + companyToRate.ico;
            setLoginurl();
        }

        var sendRating = function() {
            var rateButton = document.querySelector("#rateSection input[type=button]");
            rateButton.addEventListener("click", function(e) {
                e.preventDefault();
                var rating = new RatingRequest();
                rating.setRating(document.querySelector("#rateSection textarea")["value"]);
                rating.setStars(document.querySelector("#rateSection input:checked")["value"]);
                addRating(companyToRate.ico, rating);
                getRatings(companyToRate.ico);
                setRatingSectionData();
            });
        };

        var hideSections = function() {
            document.querySelector("#detailSection").style = "display:none";
            document.querySelector("#ratingSection").style = "display:none";
            document.querySelector("#rateSection").style = "display:none";
        };

        var windowloaded = function() {
            setSearchBar();
            setSearchBarClick();
            setSubmitButtonClick();
            setDetailButtonClick();
            setRatingButtonClick();
            setRateButtonClick();
            sendRating();
            hideSections();
        };

        window.addEventListener("load", windowloaded);
    </script>
</head>
<body>
<header><h1>Rate Service</h1></header>
<div id="content">
    <div id="searchSection">
        <form>
            <input id="ico" type="text"/>
            <input id="search" type="submit" value="Vyhledat"/>
        </form>
    </div>
    <form>
        <input id="detail" type="button" value="Detail"/>
        <input id="rating" type="button" value="Hodnocení"/>
        <input id="rate" type="button" value="Ohodnotit"/>
    </form>
    <div id="detailSection">
        <h2>Nalezená firma v databázi</h2>
        <form>
            <label>Podnikatel: </label><input id="personName" type="text"/><br/>
            <label>Obchodní jméno: </label><input id="businessName" type="text"/><br/>
            <label>IČO: </label><input id="icoNumber" type="text"/><br/>
            <label>Sídla: </label><div id="residences"></div><br/>
            <label>Živnostenská oprávnění: </label><div id="licenses"></div><br/>
        </form>
    </div>
    <div id="ratingSection">
        <h2>Hodnocení</h2>
        <form>

        </form>
    </div>
    <div id="rateSection">
        <h2>Ohodnotit</h2>
        <label>Hodnocení: </label><br/>
        <label id="companyWithIco"></label><br/><br/>
        <textarea rows="4" cols="60"></textarea><br/>
        <label>Počet hvězd: </label><input type="radio" name="stars" value="1">1
        <input type="radio" name="stars" value="2">2
        <input type="radio" name="stars" value="3">3
        <input type="radio" name="stars" value="4">4
        <input type="radio" name="stars" value="5">5<br/>
        <input type="button" value="Odeslat Hodnocení"/><a id="fblogin" href=""><img src="img/fb.png" width="28" height="28"/></a>
    </div>
</div>
</body>
</html>
